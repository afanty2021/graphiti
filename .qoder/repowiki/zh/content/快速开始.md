# 快速开始

<cite>
**本文档中引用的文件**  
- [quickstart_neo4j.py](file://examples/quickstart/quickstart_neo4j.py)
- [quickstart_falkordb.py](file://examples/quickstart/quickstart_falkordb.py)
- [quickstart_neptune.py](file://examples/quickstart/quickstart_neptune.py)
- [README.md](file://examples/quickstart/README.md)
- [requirements.txt](file://examples/quickstart/requirements.txt)
- [graphiti.py](file://graphiti_core/graphiti.py)
- [neo4j_driver.py](file://graphiti_core/driver/neo4j_driver.py)
- [search_config_recipes.py](file://graphiti_core/search/search_config_recipes.py)
- [.env.example](file://.env.example)
</cite>

## 目录
1. [安装 Graphiti](#安装-graphiti)
2. [配置环境变量](#配置环境变量)
3. [选择图数据库后端](#选择图数据库后端)
4. [运行快速入门示例](#运行快速入门示例)
5. [代码详解](#代码详解)
6. [常见问题排查](#常见问题排查)
7. [总结](#总结)

## 安装 Graphiti

要开始使用 Graphiti，首先需要通过 pip 安装 `graphiti-core` 包。这是项目的核心依赖，包含了所有必要的功能模块。

```bash
pip install graphiti-core
```

此命令将从 PyPI 安装最新版本的 Graphiti 核心库。安装完成后，您就可以在 Python 项目中导入和使用 Graphiti 的功能。

**Section sources**
- [requirements.txt](file://examples/quickstart/requirements.txt)

## 配置环境变量

Graphiti 需要一些环境变量来连接外部服务，如 LLM（大型语言模型）和图数据库。这些配置通过 `.env` 文件进行管理。

首先，创建一个名为 `.env` 的文件，并根据您的配置填入以下内容：

```bash
# 必需的 LLM 和嵌入服务
OPENAI_API_KEY=your_openai_api_key

# Neo4j 连接参数（可选，使用默认值）
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=password

# FalkorDB 连接参数（可选，使用默认值）
FALKORDB_URI=falkor://localhost:6379

# Amazon Neptune 连接参数
NEPTUNE_HOST=your_neptune_host
NEPTUNE_PORT=your_port_or_8182
AOSS_HOST=your_aoss_host
AOSS_PORT=your_port_or_443
```

**关键参数说明：**
- `OPENAI_API_KEY`：用于访问 OpenAI 的 API 密钥，是必需的，用于文本嵌入和推理。
- `NEO4J_URI`、`NEO4J_USER`、`NEO4J_PASSWORD`：用于连接本地 Neo4j 数据库的 URI、用户名和密码。
- `FALKORDB_URI`：FalkorDB 服务器的连接地址。
- `NEPTUNE_HOST` 和 `AOSS_HOST`：Amazon Neptune 和 OpenSearch 服务的主机地址。

您可以使用项目根目录下的 `.env.example` 文件作为模板来创建您的 `.env` 文件。

**Section sources**
- [.env.example](file://.env.example)
- [README.md](file://examples/quickstart/README.md)

## 选择图数据库后端

Graphiti 支持多种图数据库后端，包括 Neo4j、FalkorDB 和 Amazon Neptune。您需要根据您的需求选择并配置其中一个。

### Neo4j
确保您已安装并运行 Neo4j Desktop，并创建了一个本地 DBMS 实例。这是最简单的本地开发选项。

### FalkorDB
确保 FalkorDB 服务器正在运行。您可以通过官方文档获取安装和配置指南。

### Amazon Neptune
确保 Amazon Neptune 服务器正在运行，并正确配置了 OpenSearch 服务（AOSS）。

在代码中，您可以通过不同的驱动程序来选择后端。例如：
- 使用 `Neo4jDriver` 连接 Neo4j
- 使用 `FalkorDriver` 连接 FalkorDB
- 使用 `NeptuneDriver` 连接 Amazon Neptune

**Section sources**
- [README.md](file://examples/quickstart/README.md)

## 运行快速入门示例

Graphiti 提供了多个快速入门示例，演示了如何使用不同的图数据库后端。

### 运行步骤

1. **安装依赖**：
   ```bash
   pip install graphiti-core python-dotenv>=1.0.0
   ```

2. **设置环境变量**：
   创建 `.env` 文件并设置 `OPENAI_API_KEY` 以及所选数据库的连接参数。

3. **运行示例脚本**：
   ```bash
   # 使用 Neo4j
   python examples/quickstart/quickstart_neo4j.py

   # 使用 FalkorDB
   python examples/quickstart/quickstart_falkordb.py

   # 使用 Amazon Neptune
   python examples/quickstart/quickstart_neptune.py
   ```

这些脚本将演示如何初始化 Graphiti 实例、添加文本片段、执行搜索等基本操作。

**Section sources**
- [README.md](file://examples/quickstart/README.md)

## 代码详解

让我们深入分析 `quickstart_neo4j.py` 示例代码的关键部分。

### 初始化 Graphiti 实例

```python
graphiti = Graphiti(neo4j_uri, neo4j_user, neo4j_password)
```

这行代码创建了一个 Graphiti 实例，连接到指定的 Neo4j 数据库。它会自动初始化必要的索引和约束。

### 添加文本片段 (add_episode)

```python
await graphiti.add_episode(
    name=f'Freakonomics Radio {i}',
    episode_body=episode['content'],
    source=episode['type'],
    source_description=episode['description'],
    reference_time=datetime.now(timezone.utc),
)
```

`add_episode` 方法用于向知识图谱中添加新的信息片段（episode）。它可以处理文本或 JSON 格式的内容，并自动提取实体和关系。

### 执行基本搜索 (search)

```python
results = await graphiti.search('Who was the California Attorney General?')
```

`search` 方法执行混合搜索，结合语义相似性和 BM25 文本检索，返回相关的边（edges）结果。这是获取知识图谱中关系的主要方式。

### 使用预定义搜索配方

```python
node_search_config = NODE_HYBRID_SEARCH_RRF.model_copy(deep=True)
node_search_config.limit = 5
node_search_results = await graphiti._search(
    query='California Governor',
    config=node_search_config,
)
```

通过使用 `search_config_recipes` 中的预定义配置（如 `NODE_HYBRID_SEARCH_RRF`），您可以直接搜索节点而非边，实现更高级的搜索功能。

**Section sources**
- [quickstart_neo4j.py](file://examples/quickstart/quickstart_neo4j.py)
- [graphiti.py](file://graphiti_core/graphiti.py)
- [search_config_recipes.py](file://graphiti_core/search/search_config_recipes.py)

## 常见问题排查

在安装和运行过程中，可能会遇到一些常见问题。

### "Graph not found: default_db" 错误

**问题描述**：
当驱动程序尝试连接到不存在的数据库时，会出现此错误。

**解决方案**：
在驱动程序构造函数中指定正确的数据库名称：

```python
driver = Neo4jDriver(
    uri=neo4j_uri, 
    user=neo4j_user, 
    password=neo4j_password, 
    database="your_db_name"
)
```

### 依赖冲突

如果遇到依赖冲突，请尝试在虚拟环境中安装：

```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
pip install graphiti-core
```

### 网络问题

确保您的网络可以访问 OpenAI API 和图数据库服务。如果使用代理，请配置相应的环境变量。

**Section sources**
- [README.md](file://examples/quickstart/README.md)

## 总结

本指南详细介绍了如何在 5 分钟内完成 Graphiti 的环境搭建并运行第一个示例。我们涵盖了通过 pip 安装、配置 `.env` 环境变量、选择图数据库后端（Neo4j/FalkorDB/Neptune）的步骤，并通过 `quickstart` 示例代码演示了如何初始化 Graphiti 实例、添加文本片段和执行基本搜索。此外，还提供了常见安装问题的排查方法。现在，您可以基于这些基础开始构建自己的知识图谱应用。